

```markdown

wget http://download.redis.io/redis-stable/sentinel.conf

docker run -it --name sentinel -p 26379:26379 -v /root/sentinel.conf:/usr/local/etc/redis/sentinel.conf -d redis /bin/bash


```

```markdown

# 进入容器
$ docker exec -it sentinel bash

# 创建日志目录和文件
$ mkdir /var/log/redis
$ touch /var/log/redis/sentinel.log

# 启动哨兵
redis-sentinel /usr/local/etc/redis/sentinel.conf 

# 查看日志，哨兵成功监听到一主和两从的机器
18:X 11 Jul 2019 13:25:55.416 # +monitor master mymaster 35.236.172.131 6379 quorum 2
18:X 11 Jul 2019 13:25:55.418 * +slave slave 35.201.200.251:6379 35.201.200.251 6379 @ mymaster 35.236.172.131 6379
18:X 11 Jul 2019 13:25:55.421 * +slave slave 34.80.172.42:6379 34.80.172.42 6379 @ mymaster 35.236.172.131 6379

```

- 怎么验证sentinel的failover是否成功?

- 判断sentinel是否挂了? info命令(`info sentinel`)

sentinel启动后直接sdown，怎么处理?

- redis-sentinel配置文件未设置redis密码
- 配置文件路径错误
- 使用桥接网络模式，导致无法与redis端口建立连接
- 在配置文件中应关闭保护模式、声明可访问ip (看看在sentinel机器上是否能够连接master机器上的redis服务 `redis-cli -h 172.16.238.10 -p 6380`)



```markdown

protected-mode no
sentinel announce-ip 172.16.238.10
sentinel monitor mymaster 172.16.238.10 6380 2

```


```markdown

port 26379
dir "/tmp"
sentinel myid 5cf8ce9e522b640c18be002f39895df8843ea1d8
sentinel deny-scripts-reconfig yes
sentinel monitor mymaster 172.26.0.3 6379 2
sentinel auth-pass mymaster zxcde@1
sentinel config-epoch mymaster 1
sentinel leader-epoch mymaster 1

# Generated by CONFIG REWRITE
sentinel known-replica mymaster 172.26.0.2 6379
sentinel known-replica mymaster 172.26.0.4 6379
sentinel known-sentinel mymaster 172.26.0.6 26379 c1d5bc05ab479807f24dc73a3bfd6f62986bd48c
sentinel known-sentinel mymaster 172.26.0.7 26379 082905d0d92e8af9839b771183a29feeda2bff46
sentinel current-epoch 1

```

```markdown

port 26379
dir /tmp
sentinel announce-ip 180.76.*.*
sentinel announce-port 26381
sentinel monitor mymaster 180.76.*.* 6380 2
sentinel auth-pass mymaster redis_pwd
sentinel down-after-milliseconds mymaster 30000
sentinel parallel-syncs mymaster 1
sentinel failover-timeout mymaster 180000
sentinel deny-scripts-reconfig yes

```